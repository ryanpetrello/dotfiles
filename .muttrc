source ~/.mutt/vombatidae.mutt

# Paths -----------------------------------------------------------------------
set folder           = ~/.mail                  # mailbox location
set alias_file       = ~/.mutt/alias            # where to store aliases
set header_cache     = ~/.mutt/cache/headers    # where to store headers
set message_cachedir = ~/.mutt/cache/bodies     # where to store bodies
set certificate_file = ~/.mutt/certificates     # where to store certs
set mailcap_path     = ~/.mutt/mailcap          # entries for filetypes
set tmpdir           = ~/.mutt/temp             # where to keep temp files

# Basic Options ---------------------------------------------------------------
set wait_key = no        # shut up, mutt
set mbox_type = Maildir  # mailbox type
set timeout = 3          # idle time before scanning
set mail_check = 0       # minimum time between scans
unset move               # gmail does that
set delete               # don't ask, just do
unset confirmappend      # don't ask, just do!
set quit                 # don't ask, just do!!
unset mark_old           # read/new is good enough for me
unset beep_new           # no bell on new mails
set pipe_decode          # strip headers and eval mimes when piping
set thorough_search      # strip headers and eval mimes before searching
unset recall             # don't ask to recall messages on compose

# Sidebar Patch ---------------------------------------------------------------
set sidebar_delim   = '│'
set sidebar_visible = yes
set sidebar_width   = 32
color sidebar_new yellow default

# Status Bar ------------------------------------------------------------------
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Header Options --------------------------------------------------------------
ignore *  # Ignore all headers
unignore from: to: cc: date: subject: # show only these

# Account Settings ------------------------------------------------------------

# Default inbox.
set spoolfile = "+lists-ryanpetrello.com/INBOX"

# Alternate email addresses.
alternates ryan.petrello@dreamhost.com lists@ryanpetrello.com

# Mailboxes to show in the sidebar.
mailboxes +---ryan-------------------- \
          +ryanpetrello.com/INBOX \
          +ryanpetrello.com/starred \
          +ryanpetrello.com/sent \
          +ryanpetrello.com/drafts \
          +---lists-------------------- \
          +lists-ryanpetrello.com/INBOX \
          +lists-ryanpetrello.com/starred \
          +lists-ryanpetrello.com/sent \
          +lists-ryanpetrello.com/drafts \
          +---dreamhost------------------- \
          +dreamhost.com/INBOX \
          +dreamhost.com/pecan \
          +dreamhost.com/openstack-dev \
          +dreamhost.com/ndn-commit \
          +dreamhost.com/starred \
          +dreamhost.com/sent \
          +dreamhost.com/drafts \
          +---draughtcraft---------------- \
          +draughtcraft.com/INBOX \
          +draughtcraft.com/starred \
          +draughtcraft.com/sent \
          +---draughtcraft-errors--------- \
          +draughtcraft-errors.com/INBOX \
          +---search---------------------- \
          +temporary/search \

# Set the proper account when switching folders.
folder-hook ryanpetrello.com/* source ~/.mutt/ryan.muttrc
folder-hook lists-ryanpetrello.com/* source ~/.mutt/ryan-lists.muttrc
folder-hook dreamhost.com/*   source ~/.mutt/dreamhost.muttrc

# Automatically hide read messages when switching certain folders
folder-hook ryanpetrello.com/INBOX 'push "l~U<enter>"'
folder-hook lists-ryanpetrello.com/INBOX 'push "l~U<enter>"'
folder-hook draughtcraft.com/INBOX 'push "l~U<enter>"'
folder-hook dreamhost.com/openstack-dev 'push "l~U<enter>"'

# Update the `reading from disk` progress bar increment (for faster reads)
folder-hook . 'set read_inc=1000'

# Index View Options ----------------------------------------------------------
set date_format = "%m/%d/%y %I:%M:%S %p"             # sane date format
set index_format = "[%Z]  %-3M %D  %-30.30F  %s"     # sane index format
set sort = threads                              # like gmail
set sort_aux = reverse-last-date-received       # like gmail
set uncollapse_jump                             # don't collapse on an unread message
set sort_re                                     # thread based on regex
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

# Index Key Bindings ----------------------------------------------------------
bind index gg           first-entry         # more vimmy
bind index G            last-entry          # even more vimmy
bind index R            group-reply         # reply-all
bind index <tab>        sync-mailbox        # synchronize with mail store
bind index <space>      collapse-thread     # expand/collapse a thread
bind index <backtab>    collapse-all        # expand/collapse all threads
bind index [            previous-unread
bind index ]            next-unread

# Ctrl-R to mark all as read
macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"

# Sync email
macro index O "<shell-escape>offlineimap<enter>"           "run offlineimap to sync all mail"

# Open emails with o
macro index o "<display-message>" "open emails with o"

macro index a "<limit>all\n" "show all messages (undo limit)"

# Saner copy/move dialogs
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"

macro index,pager u  <clear-flag>N    "Mark as unread"
macro index,pager U  <set-flag>N      "Mark as read"

# Pager View Options ----------------------------------------------------------
set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs

set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
auto_view text/html
alternative_order text/plain text/enriched text/html

# Sidebar Navigation ----------------------------------------------------------
bind index,pager <down>   sidebar-next
bind index,pager <up>     sidebar-prev
bind index,pager <right>  sidebar-open

# Pager Key Bindings ----------------------------------------------------------
bind pager k  previous-line
bind pager j  next-line
bind pager gg top
bind pager G  bottom
bind pager R  group-reply
bind pager [  previous-unread
bind pager ]  next-unread

# View attachments properly.
bind attach <return> view-mailcap
macro pager \Cu "|urlview<enter>" "call urlview to open links"

# Editor ----------------------------------------------------------------------
set editor = "vim +8 -c 'set spell spelllang=en' -c 'startinsert'" # compose in vim w/ spellcheck

# Compose View Options --------------------------------------------------------
set realname = "Ryan Petrello"       # who am i?
set envelope_from                    # which from?
set sig_dashes                       # dashes before sig
set edit_headers                     # show headers when composing
set fast_reply                       # skip to compose when replying
set askcc                            # ask for CC:
set fcc_attach                       # save attachments with the body
unset mime_forward                   # forward attachments as part of body
set forward_format = "Fwd: %s"       # format of subject when forwarding
set forward_decode                   # decode when forwarding
set attribution = "On %d, %n wrote:" # format of quoting header
set reply_to                         # reply to Reply to: field
set reverse_name                     # reply as whomever it was to
set include                          # include message in replies
set forward_quote                    # include message in forwards

# Composition options ---------------------------------------------------------
bind compose p postpone-message
bind index p recall-message

# Contact management autocompletion -------------------------------------------
set query_command = "~/.mutt/search-previous-contacts '%s'"
bind editor <Tab> complete-query
bind editor ^T    complete

# Search ----------------------------------------------------------------------
macro index / "<enter-command>unset wait_key<enter><shell-escape>~/.mutt/mutt-notmuch-py ~/.mail/temporary/search<enter><change-folder-readonly>+temporary/search<enter>" "search mail (using notmuch)"
